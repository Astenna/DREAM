\chapter{Code Structure} \label{ch:code_structure}

\section{High Level Overview}

\todo{Describe, mention dockerfile}

\begin{forest}
    pic dir tree/.style={%
        for tree={%
            folder,
            font=\ttfamily,
            grow'=0,
        },
        before typesetting nodes={%
            for tree={%
                edge label+/.option={pic me},
            },
        },
    },
    pic dir tree,
    where level=0{}{% folder icons by default; override using file for file icons
        directory,
    },
    [Code
        [Client]
        [Server]
        [system\_tests]
        [docker-compose.yml, file]
    ]
\end{forest}

\section{Client}

\todo{For multiline comments look at Kinga's solution: JÃ³zef}

\begin{forest}
    pic dir tree/.style={%
        for tree={%
            folder,
            % font=\ttfamily,
            grow'=0,
            % align=left,
            % inner sep=0.009cm
        },
        before typesetting nodes={%
            for tree={%
                edge label+/.option={pic me},
            },
        },
    },
    pic dir tree,
    where level=0{}{% folder icons by default; override using file for file icons
        directory,
    },
    [\texttt{Code}
        [\texttt{Client}
            [\texttt{public}]
            [\texttt{src}
                [\texttt{api}]
                [\texttt{assets}]
                [\texttt{model}]
                [\texttt{modules}]
                [\texttt{store}]
                [\texttt{stylesheets}]
                [\texttt{values}, 
                    label=right:\textit{This is a comment about this directory.}
                ]
            ]
            [\texttt{example\_file.txt}, file,
                label=right:\textit{This is a comment about this file.}
            ]
        ]
    ]
\end{forest}

\section{Server}

\begin{forest}
    pic dir tree,
    where level=0{}{% folder icons by default; override using file for file icons
        directory,
    },
    [\texttt{Code}
        [\texttt{Server}
            [\texttt{API}
                [\texttt{Controllers},
                    label=right:\textit{Contains controllers with API endpoints definitions.},
                ]
                [\texttt{Middleware} \hspace{0.15em}
                    \textit{Contains exception middleware for mapping exceptions}\\ \hspace{21mm} \hspace{\parindent*5}
                    \textit{to proper HTTP status codes.},
                    edge path'/.expanded={
                        ([xshift=\forestregister{folder indent}]!u.parent anchor) |- ([yshift=.6ex].base west)
                }] 
                [\texttt{Properties},
                    label=right:\textit{Contains launch settings of the application.}
                ]
            ]
            [\texttt{BusinessLogic}
                [\texttt{Dtos},
                    label=right:\textit{Consists of data transfer objects definitions.}]
                [\texttt{Exceptions},
                    label=right:\textit{Contains custom exceptions.}
                ]
                [\texttt{Mapper} \hspace{0.15em}
                    \textit{Contains Mapper Profiles that defines mappings between} \\ \hspace{14mm} 
                    \textit{entities and data transfer objects.},
                    edge path'/.expanded={ ([xshift=\forestregister{folder indent}]!u.parent anchor) |- ([yshift=.6ex].base west)
                }]
                [Queries,
                    label=right:\textit{Contains classes defining query parameters available in API requests.}
                ]
                [\texttt{ServiceCollectionExtensions},
                    label=right:\textit{Defines classes required for middleware additions.}
                ]
                [\texttt{Services},
                    label=right:\textit{Contains classes with business logic.}
                ]
                [\texttt{Tools},
                    label=right:\textit{Contains utility classes such as TokenProvider for generating JWT tokens.}
                ]
            ]
            [\texttt{DataAccess}
                [\texttt{AutoMigrations} \hspace{0.15em}
                    \textit{Contains classes required for performing automatic } \\ \hspace{30mm} \textit{database migrations during application startup.},
                    edge path'/.expanded={ ([xshift=\forestregister{folder indent}]!u.parent anchor) |- ([yshift=.6ex].base west)
                }]
                [\texttt{Configuration},
                    label=right:\textit{Configures  entities relationships and constraints.}
                ]
                [\texttt{Entities},
                    label=right:\textit{Consists of entities mapped to database tables.}
                ]
                [\texttt{Migrations},
                    label=right:\textit{Consists of classes defining database migrations.}
                ]
                [\texttt{Seeder},
                    label=right:\textit{Contains SQL scripts and classes for seeding the database.}
                ]
                [\texttt{DreamDbContext} \hspace{0.15em}
                    \textit{Class that acts as a bridge between the application}\\ \hspace{30mm}
                    \textit{and the database.},
                    edge path'/.expanded={ ([xshift=\forestregister{folder indent}]!u.parent anchor) |- ([yshift=.6ex].base west)
                },
                base=top,
                file
                ]
            ]
        ]
    ]
\end{forest}

\section{System Tests}

\begin{forest}
    pic dir tree/.style={%
        for tree={%
            folder,
            font=\ttfamily,
            grow'=0,
            % align=left,
            % inner sep=0.009cm
        },
        before typesetting nodes={%
            for tree={%
                edge label+/.option={pic me},
            },
        },
    },
    pic dir tree,
    where level=0{}{% folder icons by default; override using file for file icons
        directory,
    },
    [Code
        [system\_tests,
            label=right:\textit{Parent directory for all the system tests.}
            [constants,
                label=right:\textit{Contains all the constants used including endpoints and UI messages.}
            ]
            [helpers,
                label=right:\textit{Contains functions facilitating repetitive work and seeding the database.}
            ]
            [models,
                label=right:\textit{Consists of classes that match entities existing in the system.}
            ]
            [scenarios,
                label=right:\textit{Contains functions responsible for interactions with UI components.}
            ]
            [conftest.py, file,
                label=right:\textit{File containing fixtures used throughout the testing process.}
            ]
            [pytest.ini, file,
                label=right:\textit{Primary configuration file of pytest.}
            ]
            [requirements.txt, file,
                label=right:\textit{Depicts necessary libraries to set up the testing environment.}
            ]
            [test\_assess\_farmers\_performance.py, file]
            [test\_create\_account.py, file]
            [test\_delete\_account.py, file]
            [test\_log\_in.py, file]
            [test\_log\_out.py, file]
            [test\_manage\_forum.py, file]
            [test\_manage\_help\_requests.py, file]
            [test\_manage\_production\_data.py, file]
            [test\_user\_dashboard.py, file]
            [test\_user\_summary.py, file]
        ]
    ]
\end{forest}
